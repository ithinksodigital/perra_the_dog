<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>perra the dog | Behawiorystka ps√≥w</title>
  <meta name="description" content="Behawiorystka ps√≥w ‚Äî konsultacje, wizyty w domu, spacery treningowe i warsztaty. Budujƒô relacjƒô miƒôdzy TobƒÖ a psem bez przemocy, z szacunkiem i wiedzƒÖ.">
  <meta property="og:title" content="perra the dog | Behawiorystka ps√≥w">
  <meta property="og:description" content="Konsultacje behawioralne, wizyty w domu, spacery treningowe i warsztaty. Pomagam budowaƒá spokojnƒÖ wiƒô≈∫ z psem.">
  <meta property="og:type" content="website">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='0.9em' font-size='24'>üêï</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Open+Sans:ital,wght@0,400;0,500;0,600;0,700&display=swap" rel="stylesheet" crossorigin>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <a href="#main" class="skip-link">Przejd≈∫ do tre≈õci</a>
  <nav class="nav">
    <a href="#" class="logo">perra<span> the dog</span></a>
    <div class="nav-right">
      <div class="accent-toggle" role="group" aria-label="Kolor akcentu">
        <button type="button" class="accent-option" data-accent="black" aria-pressed="false">Czarny</button>
        <button type="button" class="accent-option" data-accent="mint" aria-pressed="true">Miƒôtowy</button>
      </div>
      <ul id="nav-links" class="nav-links"><!-- wype≈Çniane z config.json --></ul>
    </div>
    <button class="nav-toggle" aria-label="Menu"><span></span><span></span><span></span></button>
  </nav>

  <nav id="dots" class="dots" aria-hidden="true"><!-- wype≈Çniane z config.json --></nav>

  <main id="main" class="onepage">
    <section id="hero" class="panel hero">
      <div class="hero-bg">
        <div class="hero-gradient"></div>
        <div class="hero-glow"></div>
        <div class="hero-grid"></div>
      </div>
      <div class="hero-inner">
        <p class="hero-label">Behawiorystka ps√≥w</p>
        <h1 class="hero-title">Zrozum swojego psa.<br>Zbuduj relacjƒô.</h1>
        <p class="hero-desc">Pomagam opiekunom i czworonogom budowaƒá spokojnƒÖ wiƒô≈∫ ‚Äî bez przemocy, z szacunkiem i wiedzƒÖ.</p>
        <div class="hero-cta">
          <a href="https://docs.google.com/forms/d/e/1FAIpQLSeBlmSgW0-hdwdbopPXT_53mEr9x1yb5A2fLIOyeW7F5iZQrQ/viewform?vc=0&c=0&w=1&flr=0&fbclid=PAZXh0bgNhZW0CMTEAc3J0YwZhcHBfaWQMMjU2MjgxMDQwNTU4AAGnId3qJH6wY5iweP23WpGJVY0xX39S6X0VwL5pXA8Rv9wchYk6CHDRBomHZ7g_aem_sLCSSdq3QrEYQtWFdeJs2g" class="btn btn-primary">Um√≥w konsultacjƒô</a>
          <a href="#uslugi" class="btn btn-ghost">Us≈Çugi</a>
        </div>
      </div>
      <a href="#uslugi" class="scroll-hint" aria-label="Przewi≈Ñ do sekcji Us≈Çugi">
        <span class="scroll-hint-text">Przewi≈Ñ w d√≥≈Ç</span>
        <div class="scroll-line"></div>
        <span class="scroll-hint-arrow" aria-hidden="true">‚Üì</span>
      </a>
    </section>

    <section id="uslugi" class="panel section">
      <div class="wrap">
        <p class="label">Co oferujƒô</p>
        <h2 class="title">Us≈Çugi</h2>
        <div id="services-grid" class="services-grid" data-json="services.json">
          <!-- Karty us≈Çug ≈Çadowane z services.json -->
        </div>
      </div>
    </section>

    <section id="galeria" class="panel section section-tint">
      <div class="wrap">
        <p class="label">Zdjƒôcia</p>
        <h2 class="title">Galeria</h2>
        <p class="intro">Kadry z konsultacji, spacer√≥w i warsztat√≥w.</p>
        <div id="gallery-grid" class="gallery-grid" data-json="gallery.json">
          <!-- Zdjƒôcia ≈Çadowane z gallery.json -->
        </div>
      </div>
    </section>

    <section id="opinie" class="panel section">
      <div class="wrap">
        <p class="label">Co m√≥wiƒÖ opiekunowie</p>
        <h2 class="title">Opinie</h2>
        <p class="intro">S≈Çowa os√≥b, kt√≥re skorzysta≈Çy z konsultacji, spacer√≥w lub warsztat√≥w.</p>
        <div class="testimonials-slider">
          <div class="testimonials-track-wrap">
            <div id="testimonials-track" class="testimonials-track" data-json="testimonials.json"><!-- slajdy wstawiane z JS --></div>
          </div>
          <div class="testimonials-nav">
            <button type="button" class="testimonials-prev" aria-label="Poprzednia opinia">‚Üê</button>
            <div id="testimonials-dots" class="testimonials-dots" aria-hidden="true"></div>
            <button type="button" class="testimonials-next" aria-label="Nastƒôpna opinia">‚Üí</button>
          </div>
        </div>
      </div>
    </section>

    <section id="formularz-zgloszeniowy" class="panel section section-tint">
      <div class="wrap">
        <p class="label">Zapisz siƒô</p>
        <h2 class="title">Formularz zg≈Çoszeniowy</h2>
        <p class="intro">Wype≈Çnij formularz ‚Äî odpowiem najszybciej jak to mo≈ºliwe.</p>
        <div id="forms-container" class="forms-grid"><!-- wype≈Çniane z config.json --></div>
      </div>
    </section>

    <section id="kontakt" class="panel section">
      <div class="wrap">
        <p class="label">BƒÖd≈∫my w kontakcie</p>
        <h2 class="title">Kontakt</h2>
        <p class="intro">Social media, lokalizacja, e-mail i telefon.</p>
        <div id="socials-container" class="socials"><!-- Instagram, Facebook z config.json --></div>
        <div id="contact-info" class="contact-info contact-info--with-icon"><!-- Warszawa (z pinezkƒÖ), email, telefon z config.json --></div>
      </div>
    </section>
  </main>

  <footer id="minimal-footer" class="footer footer--minimal">
    <div class="footer-inner wrap">
      <p class="footer-copy">¬© <span id="year"></span> perra the dog</p>
      <p id="footer-contact-info" class="footer-contact-info"><!-- Warszawa, email, telefon z config.json --></p>
    </div>
  </footer>

  <div id="cookie-bar" class="cookie-bar" role="dialog" aria-label="Informacja o ciasteczkach">
    <p class="cookie-bar-text">Ta strona u≈ºywa ciasteczek. <a href="#polityka" id="cookie-policy-link">Polityka prywatno≈õci</a>.</p>
    <button type="button" class="cookie-bar-btn" id="cookie-bar-accept">OK</button>
  </div>

  <a href="#" id="back-to-top" class="back-to-top" aria-label="Przewi≈Ñ do g√≥ry">
    <svg class="back-to-top-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M18 15l-6-6-6 6"/></svg>
  </a>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    var ACCENT_KEY = 'perra-accent';
    function getAccent() {
      try { return localStorage.getItem(ACCENT_KEY) || 'mint'; } catch (e) { return 'mint'; }
    }
    function setAccent(value) {
      try { localStorage.setItem(ACCENT_KEY, value); } catch (e) {}
      document.body.classList.toggle('accent-mint', value === 'mint');
      document.querySelectorAll('.accent-option').forEach(function(btn) {
        var isActive = btn.getAttribute('data-accent') === value;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-pressed', isActive);
      });
    }
    document.body.classList.toggle('accent-mint', getAccent() === 'mint');
    document.querySelectorAll('.accent-option').forEach(function(btn) {
      btn.classList.toggle('active', btn.getAttribute('data-accent') === getAccent());
      btn.setAttribute('aria-pressed', btn.getAttribute('data-accent') === getAccent());
      btn.addEventListener('click', function() { setAccent(btn.getAttribute('data-accent')); });
    });

    var DEFAULT_CONFIG = {
      canonicalUrl: '',
      sections: [
        { id: 'hero', visible: true, order: 0, label: 'Start', sectionLabel: 'Behawiorystka ps√≥w', title: 'Zrozum swojego psa.\nZbuduj relacjƒô.', intro: 'Pomagam opiekunom i czworonogom budowaƒá spokojnƒÖ wiƒô≈∫ ‚Äî bez przemocy, z szacunkiem i wiedzƒÖ.' },
        { id: 'uslugi', visible: true, order: 1, label: 'Us≈Çugi', sectionLabel: 'Co oferujƒô', title: 'Us≈Çugi', intro: '' },
        { id: 'galeria', visible: true, order: 2, label: 'Galeria', sectionLabel: 'Zdjƒôcia', title: 'Galeria', intro: 'Kadry z konsultacji, spacer√≥w i warsztat√≥w.' },
        { id: 'opinie', visible: true, order: 3, label: 'Opinie', sectionLabel: 'Co m√≥wiƒÖ opiekunowie', title: 'Opinie', intro: 'S≈Çowa os√≥b, kt√≥re skorzysta≈Çy z konsultacji, spacer√≥w lub warsztat√≥w.' },
        { id: 'formularz-zgloszeniowy', visible: true, order: 4, label: 'Formularz zg≈Çoszeniowy', sectionLabel: 'Zapisz siƒô', title: 'Formularz zg≈Çoszeniowy', intro: 'Wype≈Çnij formularz ‚Äî odpowiem najszybciej jak to mo≈ºliwe.' },
        { id: 'kontakt', visible: true, order: 5, label: 'Kontakt', sectionLabel: 'BƒÖd≈∫my w kontakcie', title: 'Kontakt', intro: 'Social media, lokalizacja, e-mail i telefon.' }
      ],
      forms: [
        { title: 'Konsultacja behawioralna', description: 'Um√≥w pierwszƒÖ konsultacjƒô', url: '#' },
        { title: 'Warsztaty / szkolenia', description: 'Zapisz siƒô na warsztat grupowy', url: '#' }
      ],
      socials: [
        { name: 'Instagram', url: '#', icon: 'instagram' },
        { name: 'Facebook', url: '#', icon: 'facebook' }
      ],
      footer: { city: 'Warszawa', mapUrl: '', email: 'email@example.pl', phoneHref: '+48123456789', phoneDisplay: '+48 123 456 789' }
    };
    function escapeHtml(text) {
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function applyConfig(cfg) {
      var sections = (cfg.sections || []).filter(function(s) { return s.visible !== false; }).sort(function(a, b) { return (a.order || 0) - (b.order || 0); });
      var main = document.getElementById('main');
      if (main) {
        var panels = [].slice.call(main.querySelectorAll('.panel'));
        var byId = {};
        panels.forEach(function(p) { byId[p.id] = p; });
        sections.forEach(function(s) {
          var el = byId[s.id];
          if (el) { el.style.display = ''; main.appendChild(el); }
        });
        panels.forEach(function(p) {
          if (sections.every(function(s) { return s.id !== p.id; })) p.style.display = 'none';
        });
      }

      /* Tytu≈Çy i opisy sekcji z config (sectionLabel, title, intro) */
      var allSections = cfg.sections || [];
      allSections.forEach(function(s) {
        var panel = document.getElementById(s.id);
        if (!panel) return;
        var sectionLabel = s.sectionLabel != null ? s.sectionLabel : s.label;
        var title = s.title != null ? s.title : s.label;
        var intro = s.intro != null ? s.intro : (s.description != null ? s.description : '');
        if (s.id === 'hero') {
          var hl = panel.querySelector('.hero-label');
          var ht = panel.querySelector('.hero-title');
          var hd = panel.querySelector('.hero-desc');
          if (hl && sectionLabel !== undefined) hl.textContent = sectionLabel || '';
          if (ht && title !== undefined) {
            if (String(title).indexOf('\n') !== -1) ht.innerHTML = escapeHtml(title).replace(/\n/g, '<br>');
            else ht.textContent = title || '';
          }
          if (hd) { hd.textContent = intro || ''; hd.style.display = intro ? '' : 'none'; }
        } else {
          var labelEl = panel.querySelector('.wrap .label');
          var titleEl = panel.querySelector('.wrap .title');
          var introEl = panel.querySelector('.wrap .intro');
          if (labelEl && sectionLabel !== undefined) labelEl.textContent = sectionLabel || '';
          if (titleEl && title !== undefined) titleEl.textContent = title || '';
          if (introEl) { introEl.textContent = intro || ''; introEl.style.display = intro ? '' : 'none'; }
        }
      });

      var navLinks = document.getElementById('nav-links');
      if (navLinks) {
        navLinks.innerHTML = '';
        sections.forEach(function(s) {
          if (s.id === 'hero') return;
          var li = document.createElement('li');
          var a = document.createElement('a');
          a.href = '#' + s.id;
          a.textContent = s.label || s.id;
          li.appendChild(a);
          navLinks.appendChild(li);
        });
      }

      var dotsNav = document.getElementById('dots');
      if (dotsNav) {
        dotsNav.innerHTML = '';
        sections.forEach(function(s, i) {
          var a = document.createElement('a');
          a.href = s.id === 'hero' ? '#' : '#' + s.id;
          a.className = 'dot' + (i === 0 ? ' active' : '');
          a.setAttribute('data-section', s.id);
          a.setAttribute('aria-label', s.label || s.id);
          dotsNav.appendChild(a);
        });
      }

      var formsContainer = document.getElementById('forms-container');
      if (formsContainer && cfg.forms && cfg.forms.length) {
        formsContainer.innerHTML = '';
        cfg.forms.forEach(function(f) {
          var card = document.createElement('a');
          card.href = f.url || '#';
          card.target = '_blank';
          card.rel = 'noopener noreferrer';
          card.className = 'form-card';
          card.innerHTML = '<span class="form-card-title">' + escapeHtml(f.title || '') + '</span><span class="form-card-desc">' + escapeHtml(f.description || '') + '</span><span class="form-card-arrow">‚Üí</span>';
          formsContainer.appendChild(card);
        });
      }

      var socialsContainer = document.getElementById('socials-container');
      if (socialsContainer && (cfg.socials || []).length) {
        var igPath = "M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z";
        var fbPath = "M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z";
        socialsContainer.innerHTML = '';
        cfg.socials.forEach(function(s) {
          var a = document.createElement('a');
          a.href = s.url || '#';
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.className = 'social';
          a.setAttribute('aria-label', s.name || '');
          a.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="' + (s.icon === 'instagram' ? igPath : fbPath) + '"/></svg><span>' + escapeHtml(s.name || '') + '</span>';
          socialsContainer.appendChild(a);
        });
      }

      var f = cfg.footer || {};
      var contactParts = [];
      var footerParts = [];
      var pinSvg = '<svg class="contact-info-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>';
      var emailSvg = '<svg class="contact-info-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>';
      var phoneSvg = '<svg class="contact-info-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>';
      if (f.city) {
        var locHref = (f.mapUrl && f.mapUrl.trim()) ? f.mapUrl : ('https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(f.city));
        if (locHref.indexOf('http') !== 0) locHref = 'https://' + locHref;
        contactParts.push('<a href="' + locHref + '" target="_blank" rel="noopener noreferrer" class="contact-info-link contact-info-link--with-icon">' + pinSvg + escapeHtml(f.city) + '</a>');
        footerParts.push('<a href="' + locHref + '" target="_blank" rel="noopener noreferrer" class="contact-info-link">' + escapeHtml(f.city) + '</a>');
      }
      if (f.email) {
        contactParts.push('<a href="mailto:' + escapeHtml(f.email) + '" class="contact-info-link contact-info-link--with-icon">' + emailSvg + escapeHtml(f.email) + '</a>');
        footerParts.push('<a href="mailto:' + escapeHtml(f.email) + '" class="contact-info-link">' + escapeHtml(f.email) + '</a>');
      }
      if (f.phoneHref || f.phoneDisplay) {
        var phoneNum = (f.phoneHref || f.phoneDisplay || '').replace(/\s/g, '');
        contactParts.push('<a href="tel:' + escapeHtml(phoneNum) + '" class="contact-info-link contact-info-link--with-icon">' + phoneSvg + escapeHtml(f.phoneDisplay || f.phoneHref || '') + '</a>');
        footerParts.push('<a href="tel:' + escapeHtml(phoneNum) + '" class="contact-info-link">' + escapeHtml(f.phoneDisplay || f.phoneHref || '') + '</a>');
      }
      var contactHtml = contactParts.length ? contactParts.join(' ') : '';
      var footerContactHtml = footerParts.length ? footerParts.join('<span class="contact-info-sep"> ¬∑ </span>') : '';
      var contactInfo = document.getElementById('contact-info');
      if (contactInfo) contactInfo.innerHTML = contactHtml ? '<p class="contact-info-text">' + contactHtml + '</p>' : '';
      var footerContactInfo = document.getElementById('footer-contact-info');
      if (footerContactInfo) footerContactInfo.innerHTML = footerContactHtml;

      var existingCanonical = document.querySelector('link[rel="canonical"]');
      if (existingCanonical) existingCanonical.remove();
      var canonicalUrl = (cfg.canonicalUrl && String(cfg.canonicalUrl).trim()) ? String(cfg.canonicalUrl).trim() : '';
      if (canonicalUrl) {
        if (canonicalUrl.indexOf('http') !== 0) canonicalUrl = 'https://' + canonicalUrl;
        var linkCanonical = document.createElement('link');
        linkCanonical.rel = 'canonical';
        linkCanonical.href = canonicalUrl;
        document.head.appendChild(linkCanonical);
      }

      var existingSchema = document.getElementById('schema-local-business');
      if (existingSchema) existingSchema.remove();
      var f = cfg.footer || {};
      var schema = {
        '@context': 'https://schema.org',
        '@type': 'ProfessionalService',
        name: 'perra the dog',
        description: 'Behawiorystka ps√≥w ‚Äî konsultacje, wizyty w domu, spacery treningowe i warsztaty. Budujƒô relacjƒô miƒôdzy TobƒÖ a psem bez przemocy, z szacunkiem i wiedzƒÖ.',
        url: typeof location !== 'undefined' ? location.href : ''
      };
      if (f.email) schema.email = f.email;
      if (f.phoneHref || f.phoneDisplay) schema.telephone = (f.phoneHref || f.phoneDisplay || '').replace(/\s/g, '');
      if (f.city) {
        schema.address = { '@type': 'PostalAddress', addressLocality: f.city };
        schema.areaServed = f.city;
      }
      var scriptSchema = document.createElement('script');
      scriptSchema.id = 'schema-local-business';
      scriptSchema.type = 'application/ld+json';
      scriptSchema.textContent = JSON.stringify(schema);
      document.head.appendChild(scriptSchema);

      updateDots();
    }

    fetch('config.json')
      .then(function(r) { return r.ok ? r.json() : Promise.reject(r); })
      .then(function(cfg) {
        applyConfig(cfg);
        loadData();
      })
      .catch(function() {
        applyConfig(DEFAULT_CONFIG);
        loadData();
      });

    function loadData() {
      var container = document.getElementById('services-grid');
      var jsonUrl = (container && container.getAttribute('data-json')) || 'services.json';
      function renderService(item, index) {
        var num = item.num != null ? String(item.num) : String(index + 1).padStart(2, '0');
        var card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = '<span class="card-num">' + num + '</span><h3>' + escapeHtml(item.title || '') + '</h3><p>' + escapeHtml(item.description || item.desc || '') + '</p>';
        return card;
      }
      if (container) {
        fetch(jsonUrl).then(function(r) { return r.ok ? r.json() : Promise.reject(r); }).then(function(data) {
          var list = Array.isArray(data) ? data : (data.services || data.items || []);
          container.innerHTML = '';
          list.forEach(function(item, i) { container.appendChild(renderService(item, i)); });
        }).catch(function() { container.innerHTML = '<p class="services-fallback">Brak danych. Dodaj plik services.json.</p>'; });
      }

      var galleryEl = document.getElementById('gallery-grid');
      var galleryJsonUrl = (galleryEl && galleryEl.getAttribute('data-json')) || 'gallery.json';
      function renderPhoto(item) {
        var src = typeof item === 'string' ? item : (item.src || '');
        var alt = (typeof item === 'object' && item && item.alt) ? item.alt : '';
        var box = document.createElement('div');
        box.className = 'photo-box';
        var img = document.createElement('img');
        img.src = src;
        img.alt = alt;
        img.loading = 'lazy';
        img.onerror = function() { this.style.display = 'none'; this.parentElement.classList.add('photo-box--error'); };
        box.appendChild(img);
        if (alt) { var cap = document.createElement('span'); cap.className = 'photo-box-caption'; cap.textContent = alt; box.appendChild(cap); }
        return box;
      }
      if (galleryEl) {
        fetch(galleryJsonUrl).then(function(r) { return r.ok ? r.json() : Promise.reject(r); }).then(function(data) {
          var list = Array.isArray(data) ? data : (data.images || data.photos || data.items || []);
          galleryEl.innerHTML = '';
          list.forEach(function(item) { galleryEl.appendChild(renderPhoto(item)); });
        }).catch(function() { galleryEl.innerHTML = '<p class="services-fallback">Brak danych. Dodaj plik gallery.json.</p>'; });
      }

      var testimonialsTrack = document.getElementById('testimonials-track');
      var testimonialsJsonUrl = (testimonialsTrack && testimonialsTrack.getAttribute('data-json')) || 'testimonials.json';
      function renderTestimonialSlide(item) {
        var slide = document.createElement('div');
        slide.className = 'testimonial-slide';
        var card = document.createElement('blockquote');
        card.className = 'testimonial-card';
        card.innerHTML = '<p class="testimonial-quote">' + escapeHtml(item.quote || '') + '</p><footer class="testimonial-meta"><strong class="testimonial-author">' + escapeHtml(item.author || '') + '</strong>' + (item.context ? '<span class="testimonial-context">' + escapeHtml(item.context) + '</span>' : '') + '</footer>';
        slide.appendChild(card);
        return slide;
      }
      function initTestimonialsSlider(track) {
        var slides = track.querySelectorAll('.testimonial-slide');
        var n = slides.length;
        if (n === 0) return;
        var wrap = track.parentElement;
        var prevBtn = document.querySelector('.testimonials-prev');
        var nextBtn = document.querySelector('.testimonials-next');
        var dotsEl = document.getElementById('testimonials-dots');
        var idx = 0;
        var touchStartX = 0;
        var touchStartY = 0;
        var SWIPE_MIN = 50;

        function goTo(i) {
          idx = Math.max(0, Math.min(i, n - 1));
          track.style.transform = 'translateX(-' + idx * 100 + '%)';
          if (dotsEl) {
            var dots = dotsEl.querySelectorAll('button');
            dots.forEach(function(d, k) { d.classList.toggle('active', k === idx); d.setAttribute('aria-current', k === idx ? 'true' : 'false'); });
          }
        }

        function applyDrag(px) {
          track.style.transition = 'none';
          track.style.transform = 'translateX(calc(-' + idx * 100 + '% + ' + px + 'px))';
        }

        function endDrag() {
          track.style.transition = '';
        }

        if (wrap && n > 1) {
          wrap.addEventListener('touchstart', function(e) {
            if (e.touches.length !== 1) return;
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
          }, { passive: true });
          wrap.addEventListener('touchmove', function(e) {
            if (e.touches.length !== 1) return;
            var x = e.touches[0].clientX;
            var y = e.touches[0].clientY;
            var dx = x - touchStartX;
            var dy = y - touchStartY;
            var slideWidth = wrap.offsetWidth;
            var maxDrag = slideWidth * 0.4;
            var clamped = dx;
            if (idx === 0 && dx > 0) clamped = dx * 0.3;
            else if (idx === n - 1 && dx < 0) clamped = dx * 0.3;
            else if (dx > maxDrag) clamped = maxDrag;
            else if (dx < -maxDrag) clamped = -maxDrag;
            else clamped = dx;
            applyDrag(clamped);
          }, { passive: true });
          wrap.addEventListener('touchend', function(e) {
            var endX = e.changedTouches && e.changedTouches[0] ? e.changedTouches[0].clientX : touchStartX;
            var endY = e.changedTouches && e.changedTouches[0] ? e.changedTouches[0].clientY : touchStartY;
            var dx = endX - touchStartX;
            var dy = endY - touchStartY;
            endDrag();
            if (Math.abs(dx) > SWIPE_MIN && Math.abs(dx) > Math.abs(dy)) {
              if (dx < 0) goTo(idx + 1);
              else goTo(idx - 1);
            } else {
              goTo(idx);
            }
          }, { passive: true });
        }

        if (dotsEl && n > 1) {
          dotsEl.innerHTML = '';
          for (var d = 0; d < n; d++) {
            var btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'testimonials-dot' + (d === 0 ? ' active' : '');
            btn.setAttribute('aria-label', 'Opinia ' + (d + 1));
            btn.setAttribute('aria-current', d === 0 ? 'true' : 'false');
            (function(k) { btn.addEventListener('click', function() { goTo(k); }); })(d);
            dotsEl.appendChild(btn);
          }
        }
        if (prevBtn) prevBtn.addEventListener('click', function() { goTo(idx - 1); });
        if (nextBtn) nextBtn.addEventListener('click', function() { goTo(idx + 1); });
        goTo(0);
      }
      if (testimonialsTrack) {
        fetch(testimonialsJsonUrl).then(function(r) { return r.ok ? r.json() : Promise.reject(r); }).then(function(data) {
          var list = Array.isArray(data) ? data : (data.testimonials || data.items || []);
          testimonialsTrack.innerHTML = '';
          list.forEach(function(item) { testimonialsTrack.appendChild(renderTestimonialSlide(item)); });
          initTestimonialsSlider(testimonialsTrack);
        }).catch(function() { testimonialsTrack.innerHTML = '<p class="services-fallback">Brak danych. Dodaj plik testimonials.json.</p>'; });
      }
    }

    document.querySelector('.nav-toggle').addEventListener('click', function() {
      var right = document.querySelector('.nav-right');
      if (right) right.classList.toggle('open');
      this.classList.toggle('open');
    });
    document.getElementById('nav-links').addEventListener('click', function(e) {
      if (e.target.tagName === 'A') {
        var right = document.querySelector('.nav-right');
        var toggle = document.querySelector('.nav-toggle');
        if (right) right.classList.remove('open');
        if (toggle) toggle.classList.remove('open');
      }
    });

    function updateDots() {
      var panels = document.querySelectorAll('.panel');
      var dots = document.querySelectorAll('.dot');
      if (!panels.length || !dots.length) return;
      var vh = window.innerHeight;
      var scroll = window.scrollY;
      var current = 'hero';
      panels.forEach(function(p) {
        var top = p.offsetTop;
        if (scroll >= top - vh * 0.4) current = p.id || current;
      });
      dots.forEach(function(d) {
        var href = d.getAttribute('href');
        var isActive = href === '#' ? current === 'hero' : href.slice(1) === current;
        d.classList.toggle('active', isActive);
      });
    }
    var scrollTick = false;
    function onScroll() {
      if (scrollTick) return;
      scrollTick = true;
      requestAnimationFrame(function() {
        updateDots();
        var minimalFooter = document.getElementById('minimal-footer');
        var kontaktPanel = document.getElementById('kontakt');
        if (minimalFooter) {
          var showFooter = window.scrollY > 60;
          if (kontaktPanel) {
            var kontaktTop = kontaktPanel.offsetTop;
            var viewportPastKontakt = window.scrollY + window.innerHeight * 0.25 >= kontaktTop;
            if (viewportPastKontakt) showFooter = false;
          }
          minimalFooter.classList.toggle('visible', showFooter);
        }
        scrollTick = false;
      });
    }
    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('load', function() {
      updateDots();
      var minimalFooter = document.getElementById('minimal-footer');
      var kontaktPanel = document.getElementById('kontakt');
      if (minimalFooter) {
        var showFooter = window.scrollY > 60;
        if (kontaktPanel) {
          var kontaktTop = kontaktPanel.offsetTop;
          if (window.scrollY + window.innerHeight * 0.25 >= kontaktTop) showFooter = false;
        }
        minimalFooter.classList.toggle('visible', showFooter);
      }
    });

    var backToTop = document.getElementById('back-to-top');
    if (backToTop) {
      function toggleBackToTop() {
        backToTop.classList.toggle('visible', window.scrollY > 400);
      }
      window.addEventListener('scroll', toggleBackToTop, { passive: true });
      window.addEventListener('load', toggleBackToTop);
      backToTop.addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('main').scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    }

    document.querySelectorAll('.panel').forEach(function(panel) {
      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(e) { if (e.isIntersecting) e.target.classList.add('in'); });
      }, { threshold: 0.15 });
      observer.observe(panel);
    });

    var COOKIE_CONSENT_KEY = 'perra-cookies-accepted';
    var cookieBar = document.getElementById('cookie-bar');
    if (cookieBar) {
      try {
        if (localStorage.getItem(COOKIE_CONSENT_KEY)) cookieBar.classList.add('hidden');
      } catch (e) {}
      document.getElementById('cookie-bar-accept').addEventListener('click', function() {
        try { localStorage.setItem(COOKIE_CONSENT_KEY, '1'); } catch (e) {}
        cookieBar.classList.add('hidden');
      });
    }
  </script>
</body>
</html>
